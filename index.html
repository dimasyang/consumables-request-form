<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å—æµ·è±ï½œåŒ…è£è€—æé ˜ç”¨ï¼ˆæ¥µç°¡æ‰‹æ©Ÿç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<style>
  :root {
    --nhf-bg: #f3f4f6;
    --nhf-card: #ffffff;
    --nhf-border: #e5e7eb;
    --nhf-text: #111827;
    --nhf-muted: #6b7280;
    --nhf-primary: #0f766e;      /* æµ·è—ç¶  */
    --nhf-primary-soft: #ccfbf1; /* æ·ºè—ç¶ åº• */
    --nhf-danger: #b91c1c;
    --nhf-accent: #f97316;       /* ä¸€é»æš–è‰²æç¥ */
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", system-ui, sans-serif;
    background: radial-gradient(circle at top, #e5f3ff 0, #f3f4f6 45%, #e5e7eb 100%);
    color: var(--nhf-text);
  }

  /* é ‚ç«¯å“ç‰Œè‰²æ¢ */
  .top-bar {
    height: 4px;
    width: 100%;
    background: linear-gradient(90deg, #0f766e, #14b8a6, #f97316);
    box-shadow: 0 2px 6px rgba(15, 23, 42, 0.25);
  }

  .app {
    max-width: 960px;
    margin: 0 auto;
    padding: 12px 10px 16px;
  }

  /* ---------- é ‚éƒ¨æ¨™é¡Œå€ ---------- */
  h1 {
    font-size: 1.05rem;
    margin: 0;
    font-weight: 700;
    letter-spacing: 0.03em;
    color: #0b1120;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  h1::before {
    content: "ğŸ“¦";
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    border-radius: 999px;
    background: linear-gradient(135deg, #0f766e, #14b8a6);
    color: #ecfeff;
    font-size: 0.8rem;
  }

  .sub {
    font-size: 0.78rem;
    color: var(--nhf-muted);
    margin-top: 4px;
    margin-bottom: 10px;
  }

  /* ---------- å¹´æœˆåˆ— ---------- */
  .row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: center;
    margin-bottom: 8px;
    font-size: 0.8rem;
    padding: 8px 10px;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.85);
    border: 1px solid rgba(148, 163, 184, 0.4);
    box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
  }

  .row span:first-child {
    font-weight: 600;
    color: #0f172a;
  }

  select,
  button,
  input[type="text"],
  input[type="number"],
  textarea {
    font-family: inherit;
    font-size: 0.8rem;
  }

  select {
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid #d4d4d8;
    background: #f9fafb;
    outline: none;
  }

  select:focus {
    border-color: #0f766e;
    box-shadow: 0 0 0 1px rgba(15, 118, 110, 0.35);
    background: #ffffff;
  }

  #monthInfo {
    font-size: 0.8rem;
    color: var(--nhf-muted);
    margin-left: auto;
  }

  /* ---------- å·¥å…·åˆ—ï¼ˆåšæˆå°å·¥å…·æ¢ã€å¾®æµ®èµ·ï¼‰ ---------- */
  .toolbar {
    position: sticky;
    top: 0;
    z-index: 15;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin: 10px 0 8px;
    padding: 8px 10px;
    background: rgba(248, 250, 252, 0.96);
    backdrop-filter: blur(12px);
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
  }

  button {
    padding: 6px 11px;
    border-radius: 999px;
    border: 1px solid #d4d4d8;
    background: #ffffff;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    white-space: nowrap;
    transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.08s ease, border-color 0.08s ease;
  }

  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 12px rgba(15, 23, 42, 0.12);
    background: #f9fafb;
  }

  button:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(15, 23, 42, 0.18);
  }

  button.primary {
    background: linear-gradient(135deg, var(--nhf-primary), #14b8a6);
    color: #ecfeff;
    border-color: #0f766e;
    box-shadow: 0 6px 14px rgba(15, 118, 110, 0.4);
  }

  button.primary:hover {
    background: linear-gradient(135deg, #0d9488, #22c55e);
  }

  button.danger {
    background: #fef2f2;
    color: var(--nhf-danger);
    border-color: #fecaca;
  }

  button.danger:hover {
    background: #fee2e2;
  }

  /* ---------- æ‘˜è¦å€ ---------- */
  .summary {
    font-size: 0.8rem;
    margin-bottom: 8px;
    padding: 8px 10px;
    border-radius: 10px;
    background: linear-gradient(135deg, #ecfeff, #fefce8);
    border: 1px solid rgba(148, 163, 184, 0.4);
    display: grid;
    row-gap: 2px;
  }

  .summary strong {
    color: var(--nhf-accent);
    font-weight: 700;
  }

  /* ---------- æœå°‹åˆ— ---------- */
  .search-box {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: center;
    margin-bottom: 4px;
    font-size: 0.8rem;
    padding: 6px 10px;
    border-radius: 10px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
  }

  .search-box span {
    color: #0f172a;
    font-weight: 500;
  }

  .search-box input {
    flex: 1;
    min-width: 120px;
    padding: 5px 8px;
    border-radius: 999px;
    border: 1px solid #d4d4d8;
    background: #ffffff;
    outline: none;
  }

  .search-box input:focus {
    border-color: #0f766e;
    box-shadow: 0 0 0 1px rgba(15, 118, 110, 0.3);
  }

  .info {
    font-size: 0.72rem;
    color: var(--nhf-muted);
    margin: 4px 2px 6px;
  }

  .ranking-toggle-row {
    margin-bottom: 6px;
  }

  .ranking-section {
    display: none;
    padding: 8px 10px;
    background: #ffffff;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    margin-bottom: 10px;
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
  }

  .ranking-section > div {
    font-size: 0.78rem;
    margin-bottom: 6px;
    font-weight: 500;
    color: #0f172a;
  }

  .ranking-section table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.72rem;
  }

  .ranking-section th,
  .ranking-section td {
    border-bottom: 1px solid #e5e7eb;
    padding: 4px 4px;
    text-align: left;
    white-space: nowrap;
  }

  .ranking-section th {
    font-weight: 600;
    color: #4b5563;
  }

  .items {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 6px;
  }

  /* ---------- å–®ä¸€å“é …å¡ç‰‡ ---------- */
  .item-card {
    background: var(--nhf-card);
    border-radius: 14px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    padding: 8px 10px 8px;
    font-size: 0.8rem;
    box-shadow: 0 10px 22px rgba(15, 23, 42, 0.09);
  }

  .item-header {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    align-items: center;
    margin-bottom: 6px;
  }

  .index-badge {
    font-size: 0.72rem;
    padding: 2px 6px;
    border-radius: 999px;
    background: #e5e7eb;
    color: #374151;
    font-weight: 600;
  }

  .item-header input[type="text"] {
    padding: 4px 6px;
    border-radius: 999px;
    border: 1px solid #d4d4d8;
    background: #f9fafb;
    min-width: 70px;
    outline: none;
  }

  .item-header input[type="text"]:focus {
    border-color: #0f766e;
    background: #ffffff;
    box-shadow: 0 0 0 1px rgba(15, 118, 110, 0.25);
  }

  .item-header input[type="text"]:last-child {
    flex: 1;
  }

  .line {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-bottom: 4px;
    align-items: center;
  }

  .line label {
    font-size: 0.72rem;
    color: #4b5563;
    padding: 2px 4px;
    border-radius: 999px;
    background: #f3f4f6;
  }

  .line input[type="text"],
  .line input[type="number"] {
    padding: 3px 6px;
    min-width: 60px;
    border-radius: 8px;
    border: 1px solid #d4d4d8;
    background: #f9fafb;
    outline: none;
  }

  .line input[type="text"]:focus,
  .line input[type="number"]:focus {
    border-color: #0f766e;
    background: #ffffff;
    box-shadow: 0 0 0 1px rgba(15, 118, 110, 0.25);
  }

  textarea {
    width: 100%;
    padding: 4px 6px;
    resize: vertical;
    min-height: 40px;
    border-radius: 10px;
    border: 1px solid #d4d4d8;
    background: #f9fafb;
    font-size: 0.78rem;
    outline: none;
  }

  textarea:focus {
    border-color: #0f766e;
    background: #ffffff;
    box-shadow: 0 0 0 1px rgba(15, 118, 110, 0.22);
  }

  /* ---------- æ¯æ—¥ç”¨é‡å€ ---------- */
  .days {
    margin-top: 6px;
    border-top: 1px dashed #e5e7eb;
    padding-top: 6px;
  }

  .days-title {
    font-size: 0.75rem;
    color: #4b5563;
    margin-bottom: 4px;
    font-weight: 500;
  }

  .days-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(72px, 1fr));
    gap: 4px;
  }

  .day-cell {
    display: flex;
    flex-direction: column;
    font-size: 0.72rem;
    padding: 4px;
    border-radius: 8px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
  }

  .day-cell span {
    color: #4b5563;
    margin-bottom: 2px;
  }

  .day-cell input {
    padding: 3px 4px;
    border-radius: 6px;
    border: 1px solid #d4d4d8;
    background: #ffffff;
    outline: none;
  }

  .day-cell input:focus {
    border-color: #0f766e;
    box-shadow: 0 0 0 1px rgba(15, 118, 110, 0.2);
  }

  .item-footer {
    margin-top: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    padding-top: 4px;
  }

  .item-footer strong {
    color: var(--nhf-accent);
  }

  .item-footer button.danger {
    font-size: 0.72rem;
    padding-inline: 10px;
  }

  /* ---------- RWD ---------- */
  @media (max-width: 640px) {
    .app {
      padding-inline: 8px;
    }

    .toolbar {
      top: 0;
      padding-inline: 8px;
    }

    #monthInfo {
      width: 100%;
      margin-left: 0;
      margin-top: 2px;
    }
  }

  /* ç…§ç‰‡å€å¡Šæ¨£å¼ */
  .photo-line {
    align-items: flex-start;
  }
  .photo-actions {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .photo-preview {
    width: 80px;
    height: 80px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    object-fit: cover;
    margin-left: 4px;
  }
  .photo-note {
    font-size: 0.72rem;
    color: #6b7280;
  }
  .photo-status {
    font-size: 0.72rem;
    margin-top: 2px;
  }
  .photo-status-ok {
    color: #16a34a;
  }
  .photo-status-warn {
    color: #f97316;
  }
  .photo-status-wait {
    color: #0f766e;
  }
  .photo-line input[type="file"] {
    font-size: 0.72rem;
  }

  /* ç…§ç‰‡ç¸½è¦½ gallery */
  .gallery-toggle-btn {
    font-size: 0.8rem;
    padding: 5px 8px;
    border-radius: 999px;
    border: 1px dashed #0f766e;
    background: #ecfeff;
    color: #0f766e;
  }
  .gallery-overlay {
    position: fixed;
    inset: 0;
    background: rgba(15,23,42,0.75);
    backdrop-filter: blur(10px);
    z-index: 40;
    display: none;
    flex-direction: column;
    padding: 10px;
  }
  .gallery-overlay.active {
    display: flex;
  }
  .gallery-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    color: #f9fafb;
  }
  .gallery-header-title {
    font-size: 0.9rem;
    font-weight: 600;
  }
  .gallery-close-btn {
    margin-left: auto;
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid rgba(148,163,184,0.8);
    background: transparent;
    color: #e5e7eb;
    font-size: 0.8rem;
  }
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 8px;
    overflow-y: auto;
  }
  .gallery-item {
    background: #0b1120;
    border-radius: 10px;
    padding: 4px;
    border: 1px solid rgba(148,163,184,0.5);
  }
  .gallery-thumb {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    border-radius: 8px;
    margin-bottom: 2px;
  }
  .gallery-caption {
    font-size: 0.68rem;
    color: #e5e7eb;
    line-height: 1.2;
  }

  /* å¤§åœ– Lightbox */
  .lightbox {
    position: fixed;
    inset: 0;
    background: rgba(15,23,42,0.9);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 50;
    padding: 10px;
  }
  .lightbox.active {
    display: flex;
  }
  .lightbox-img {
    max-width: 100%;
    max-height: 100%;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.6);
  }

  /* é—œå¸³æ¨¡å¼ï¼šé–å®š item-card å…§çš„è¼¸å…¥èˆ‡æŒ‰éˆ• */
  .app.closed-mode .item-card input,
  .app.closed-mode .item-card select,
  .app.closed-mode .item-card textarea,
  .app.closed-mode .item-card button {
    pointer-events: none;
    opacity: 0.6;
  }

  .app.closed-mode .item-card .photo-preview {
    pointer-events: none;
  }

  /* é—œå¸³æç¤º */
  #closeNote {
    margin-top: 4px;
  }
</style>

</head>
<body>
  <div class="top-bar"></div>
  <div class="app">
    <h1>å—æµ·è± åŒ…è£è€—æé ˜ç”¨ï¼ˆæ¥µç°¡æ‰‹æ©Ÿç‰ˆï¼‰</h1>
    <div class="sub">å¤šå¹´ä»½ Â· å–®æ©Ÿä½¿ç”¨ Â· è³‡æ–™ä¿å­˜åœ¨ç€è¦½å™¨ï¼ˆlocalStorageï¼‰ï¼Œé©åˆç¾å ´ç”¨æ‰‹æ©Ÿç´€éŒ„ã€‚</div>
    <div id="closeNote" class="info"></div>

    <div class="row">
      <span>ğŸ“† å¹´æœˆï¼š</span>
      <select id="yearSelect" onchange="onYearMonthChange()">
        <option value="114">114 å¹´</option>
        <option value="115">115 å¹´</option>
        <option value="116">116 å¹´</option>
        <option value="117">117 å¹´</option>
      </select>
      <select id="monthSelect" onchange="onYearMonthChange()">
        <option value="11">11 æœˆ</option>
        <option value="12">12 æœˆ</option>
        <option value="1">1 æœˆ</option>
        <option value="2">2 æœˆ</option>
        <option value="3">3 æœˆ</option>
        <option value="4">4 æœˆ</option>
        <option value="5">5 æœˆ</option>
        <option value="6">6 æœˆ</option>
        <option value="7">7 æœˆ</option>
        <option value="8">8 æœˆ</option>
        <option value="9">9 æœˆ</option>
        <option value="10">10 æœˆ</option>
      </select>
      <span id="monthInfo" style="font-size:0.8rem;color:#6b7280;">ç›®å‰ï¼š114 å¹´ 11 æœˆ</span>
    </div>

    <div class="toolbar">
      <button class="primary" onclick="addItem()">ï¼‹ æ–°å¢å“é …</button>
      <button onclick="saveData()">ğŸ’¾ å„²å­˜æœ¬æœˆè³‡æ–™</button>
      <button onclick="exportCsv()">ğŸ“¤ åŒ¯å‡ºæœ¬æœˆå ±è¡¨</button>
      <button onclick="showTodayOnly()">ğŸ“… åªçœ‹ä»Šå¤©</button>
      <button onclick="showAllDays()">ğŸ—“ é¡¯ç¤ºå…¨éƒ¨æ—¥æœŸ</button>
      <button class="danger" onclick="clearData()">ğŸ§¹ æ¸…é™¤æœ¬æœˆæš«å­˜</button>
      <button class="gallery-toggle-btn" onclick="openGallery()">ğŸ“· ç…§ç‰‡ç¸½è¦½</button>
      <button id="closeBtn" onclick="toggleCloseMonth()">ğŸ”’ æœ¬æœˆé—œå¸³</button>
    </div>

    <div class="summary">
      <div>ğŸ“… æœ¬æœˆå¤©æ•¸ï¼š<span id="daysInfo">30 å¤©</span> <span id="dayFilterInfo"></span></div>
      <div>ğŸ’° æœ¬æœˆç´¯è¨ˆé ˜ç”¨é‡‘é¡ï¼š<strong id="grandTotal">0</strong> å…ƒ</div>
      <div>ğŸ“¦ å“é …æ•¸é‡ï¼š<span id="itemCount">0</span> å€‹</div>
    </div>

    <div class="search-box">
      <span>ğŸ” æœå°‹å“é …ï¼š</span>
      <input id="searchInput" type="text" placeholder="çœŸç©ºè¢‹ / ç´™ç®± / è²¼ç´™â€¦" oninput="onSearchChange()" />
      <button onclick="resetSearch()">æ¸…é™¤æœå°‹</button>
    </div>
    <div class="info" id="searchInfo"></div>

    <div class="ranking-toggle-row">
      <button id="rankingToggleBtn" onclick="toggleRanking()">ğŸ“Š é¡¯ç¤ºæ’è¡Œ</button>
    </div>

    <div id="rankingSection" class="ranking-section">
      <div style="font-size:0.8rem;margin-bottom:4px;">ğŸ“Š æœ¬æœˆç”¨é‡æ’è¡Œï¼ˆä¾ç¸½ç”¨é‡ï¼Œç”±å¤§åˆ°å°ï¼‰</div>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>å“é …</th>
            <th>å“å</th>
            <th>ç¸½ç”¨é‡</th>
            <th>é‡‘é¡å°è¨ˆ</th>
          </tr>
        </thead>
        <tbody id="rankingBody"></tbody>
      </table>
    </div>


    <!-- ç…§ç‰‡ç¸½è¦½ overlay -->
    <div class="gallery-overlay" id="galleryOverlay">
      <div class="gallery-header">
        <div class="gallery-header-title">ğŸ“· è€—æç…§ç‰‡ç¸½è¦½</div>
        <input id="gallerySearch" type="text" placeholder="æœå°‹å“é … / å“å / å» å•†" style="flex:1; max-width:210px; padding:4px 8px; border-radius:999px; border:1px solid #cbd5f5; font-size:0.75rem;">
        <button class="gallery-close-btn" onclick="closeGallery()">é—œé–‰</button>
      </div>
      <div class="gallery-grid" id="galleryGrid"></div>
    </div>

    <!-- å¤§åœ– Lightbox -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
      <img id="lightboxImg" class="lightbox-img" src="" alt="è€—æç…§ç‰‡é è¦½">
    </div>

    <div class="items" id="itemsContainer"></div>
  </div>

  <script>
    const TEMPLATE_ITEMS = [{"category": "çœŸç©ºè¢‹", "supplier": "åŒ…è£å·¥å ´", "name": "é£Ÿå“ç´šçœŸç©ºåŒ…è£è¢‹", "spec": "(1.)NY2030\n20 x 30 cm+åš0.09mm", "unit": "100å…¥/åŒ…", "unitPrice": 240.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ä¸¸ã€é­š", "note": "åŒ…è£å·¥å ´\n0918-199246\n0958-199246\n0956-199246\n\nLINEï¼šåŒ…è£å·¥å ´"}, {"category": NaN, "supplier": NaN, "name": NaN, "spec": "(2.)NY1737\n17 x 37 cm+åš0.08mm", "unit": NaN, "unitPrice": 1.9, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "é®­", "note": NaN}, {"category": NaN, "supplier": NaN, "name": NaN, "spec": "(3.)NY1727\n17 x 27 cm+åš0.08mm", "unit": NaN, "unitPrice": 1.35, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "é¯–", "note": NaN}, {"category": NaN, "supplier": NaN, "name": NaN, "spec": "(4.)NY1547\n15.5 x 47cm+åš0.08mm", "unit": NaN, "unitPrice": 2.25, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "å°¾å·´", "note": NaN}, {"category": NaN, "supplier": NaN, "name": NaN, "spec": "(5.)NY2737\n27 x 37 cm+åš0.09cm", "unit": NaN, "unitPrice": 3.75, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "180-200gå¤§å°¾è‚‰é²«é­šã€é®­é­šé ­", "note": NaN}, {"category": NaN, "supplier": NaN, "name": NaN, "spec": "(6.)NY1323\n13 x 23 cm åš0.08cm", "unit": NaN, "unitPrice": 0.88, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "è¦ä»", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "çœŸç©ºç«™ç«‹å¤¾éˆç«‹è¢‹", "spec": "17*28cm ", "unit": "50å…¥/åŒ…ã€\n40åŒ…/ç®±", "unitPrice": 3.2, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ç”œè¦(æ–°)", "note": NaN}, {"category": NaN, "supplier": "è¬è¢‹å½©å°LINEï¼šåŒ…è£è¢‹å»–å°å§", "name": "çœŸç©ºå¤¾éˆç«‹è¢‹-å¤§åŠæ–¤", "spec": "NYB05-1\n175 x 260 mm+45mm", "unit": "100å…¥/åŒ…", "unitPrice": 3.3, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ç”œè¦", "note": "$3.3/PC"}, {"category": NaN, "supplier": NaN, "name": "çœŸç©ºè¢‹", "spec": "N220400\n220 x 400 mm", "unit": NaN, "unitPrice": 1.8, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ç§‹åˆ€é­š/å¤§ç‰‡é®­é­š", "note": "$1.8/PC"}, {"category": NaN, "supplier": NaN, "name": NaN, "spec": "N200300\n200 x 300 mm(80u)", "unit": NaN, "unitPrice": 1.75, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": "æ•´ä»¶28åŒ… $1.75/PC"}, {"category": NaN, "supplier": "é‡‘ç¦¾åº„åŒ…è£", "name": "çœŸç©ºå¹³é¢è¢‹(æ•´ä»¶)", "spec": "DD01-01/02\n20X30(80u)", "unit": NaN, "unitPrice": 1.8, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": "æ•´ä»¶25åŒ… $1.8/PC"}, {"category": "å¤¾éˆè¢‹", "supplier": "å¯Œç”°å–¬åŒ…è£", "name": "é€²å£-ç‰›çš®é–‹çª—éœ§é¢å¤¾éˆç«‹è¢‹ ", "spec": "150*220+40MM", "unit": "50å€‹/åŒ…", "unitPrice": 2.5, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ä¸€å£çƒã€é›ªQé¤…ã€ç«çƒ¤çƒ", "note": "å¯Œç”°å–¬åŒ…è£\nhttps://www.futienjoe.com.tw/"}, {"category": NaN, "supplier": "é‡‘ç¦¾åº„åŒ…è£", "name": "ç‰›çš®éœ§é¢é–‹çª—å¤¾éˆç«‹è¢‹", "spec": "DF03-01-03\n15X22+4CM", "unit": "50å€‹/åŒ…", "unitPrice": 2.4, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ä¸€å£çƒã€é›ªQé¤…ã€ç«çƒ¤çƒ", "note": " é‡‘ç¦¾åº„åŒ…è£ææ–™\n06-355-6699\nhttps://reurl.cc/nEd8o8"}, {"category": NaN, "supplier": NaN, "name": "ç™½ç‰›çš®éœ§é¢é–‹çª—å¤¾éˆç«‹è¢‹", "spec": "DF03-02-04\n15X22+4CM", "unit": "50å€‹/åŒ…", "unitPrice": 2.5, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ç‰›è»‹ç³–", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "éœ§é¢å¤¾éˆç«‹è¢‹", "spec": "DF04-02-06\n18X26+4CM", "unit": "50å€‹/åŒ…", "unitPrice": 2.5, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ä¸€å£é®‘", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "éœ§é¢å¤¾éˆç«‹è¢‹", "spec": "DF04-02-05\n17X23+4CM ", "unit": "50å€‹/åŒ…", "unitPrice": 2.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "é¦¬æ—ç³–", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é€æ˜å¤¾éˆç«‹è¢‹", "spec": "DF04-03-04\n12X20+4CM", "unit": "50å€‹/åŒ…", "unitPrice": 0.9, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ä¸€å£é®‘(3é¡†å…¥)", "note": NaN}, {"category": NaN, "supplier": "æ«»æ¡ƒå±‹", "name": "éœ§é¢å¤¾éˆç«‹è¢‹", "spec": "18*26+4CM", "unit": "50å€‹/åŒ…", "unitPrice": 7.2, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ä¸€å£é®‘", "note": "æ«»æ¡ƒå±‹\nç¶“ç† é™³æ·‘èŠ¬\n0936-264-721\né«˜é›„07-2367786\nhttps://reurl.cc/k7Y62x"}, {"category": NaN, "supplier": NaN, "name": "éœ§é¢å¤¾éˆç«‹è¢‹", "spec": "16*24+4CM", "unit": "50å€‹/åŒ…", "unitPrice": 5.8, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "é¦¬æ—ç³–", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "çœŸç©ºå¤¾éŠç«‹è¢‹", "spec": "4å…©13x22cm\n(æ¢ç¢¼19092034)", "unit": "50å€‹/åŒ…", "unitPrice": 5.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ä¸€å£é®‘(3é¡†å…¥)", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "çœŸç©ºå¤¾éŠç«‹è¢‹", "spec": "å•†å“ç·¨è™Ÿ17092040\n22x35cm", "unit": "25å€‹/åŒ…", "unitPrice": 12.8, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ç¿ ç¿ é…ªé…ªåŒ…(6é¡†)", "note": NaN}, {"category": NaN, "supplier": "ä¸‰é³³ä¸­è¡—è³¼å…¥\n(ä½©æ¨ºè²·çš„)", "name": "é€æ˜å¤¾éŠå¹³è¢‹", "spec": NaN, "unit": "50å€‹", "unitPrice": 2.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "æŸ³è‘‰é­šä¹¾", "note": NaN}, {"category": "é€æ˜ç›¤", "supplier": NaN, "name": "é€æ˜ç›¤", "spec": NaN, "unit": "200å€‹", "unitPrice": 1.2, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "æŸ³è‘‰é­šä¹¾", "note": NaN}, {"category": "ç´™ç®±", "supplier": "å°æ—ç´™ç®±-å°ç£è£½é€ ", "name": "ä¸‰å±¤Bæ¥ç´™ç®±", "spec": "6è™Ÿç´™ç®±\n30x25x15", "unit": "50å€‹/ç®±", "unitPrice": 11.68, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ç‰›è»‹5å…¥ã€10å…¥\n/å¸¸æº«è¶…å•†å¯„ä»¶", "note": "å®¢è£½éœ€ææ—©5å¤©è¨‚\nå°æ—ç´™ç®±-å°ç£è£½é€ \nhttps://reurl.cc/7eQG3N"}, {"category": NaN, "supplier": NaN, "name": "ä¸‰å±¤Bæ¥ç´™ç®±", "spec": "1è™Ÿç´™ç®±\n45x30x30 ", "unit": "40å€‹/ç®±", "unitPrice": 15.75, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "é­šé¬†ç¦®ç›’/ç‰›è»‹30å…¥(æœ€å¤š)\n/è¶…å•†å¸¸æº«æœ€å¤§å°ºå¯¸", "note": NaN}, {"category": NaN, "supplier": "å’ªå’ªè³¼ç‰©", "name": "ä¸‰å±¤Bæ¥ç´™ç®±", "spec": "5è™Ÿ\n30x25x15", "unit": "20å€‹/æ†", "unitPrice": 9.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ç‰›è»‹5å…¥ã€10å…¥\n/å¸¸æº«è¶…å•†å¯„ä»¶", "note": "å’ªå’ªè³¼ç‰©\nhttps://reurl.cc/nEdayv"}, {"category": NaN, "supplier": NaN, "name": "ä¸‰å±¤Bæ¥ç´™ç®±", "spec": "1è™Ÿ\n44x29x29 ", "unit": "20å€‹/æ†", "unitPrice": 15.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "é­šé¬†ç¦®ç›’/ç‰›è»‹30å…¥(æœ€å¤š)\n/è¶…å•†å¸¸æº«æœ€å¤§å°ºå¯¸", "note": NaN}, {"category": NaN, "supplier": "æ¡ƒåœ’ç´™ç®±å°å°‡", "name": "ä¸‰å±¤Bæ¥ç´™ç®±", "spec": "45x30x15  CM", "unit": "20-120å€‹", "unitPrice": 17.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ç¦®ç›’*2/æµ·è‹”*20", "note": "æ¡ƒåœ’ç´™ç®±å°å°‡https://bit.ly/3dNnxUo"}, {"category": NaN, "supplier": "LINEå°å©•", "name": "ç´™ç®±(ä¸é˜²æ°´)", "spec": "(å°)30x25x15", "unit": "1å€‹", "unitPrice": 8.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "S60å¸¸æº«", "note": "LINEè¯ç¹«"}, {"category": NaN, "supplier": NaN, "name": "ç´™ç®±(é˜²æ°´)", "spec": "(å°)30x25x15", "unit": "1å€‹", "unitPrice": 8.5, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "S60å¸¸æº«", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "ç´™ç®±(é˜²æ°´)", "spec": "(ä¸­)45x30x15", "unit": 1, "unitPrice": 11.3, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "æµ·è‹”20ï¼Œçƒé­šå­æç›’11", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "ç´™ç®±", "spec": "\n(å¤§)44x29x29 ", "unit": "1å€‹", "unitPrice": 20.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "çƒé‡‘æ—º(6)*10/å¤§ç¦®ç›’*5/ 2å…¥é³³æ¢¨é…¥32ç›’", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "ç´™ç®±", "spec": "(ç‰¹å¤§)74.4x42x22.2", "unit": "1å€‹", "unitPrice": 23.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "è›‹æ²è¨­è¨ˆæ¬¾ç¦®ç›’", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "ç´™ç®±", "spec": "(ç‰¹å¤§)74.4x42x22.2", "unit": "1å€‹", "unitPrice": 23.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "çƒé‡‘æ—º(6)*20/å¤§ç¦®ç›’*10/ 2å…¥é³³æ¢¨é…¥60ç›’", "note": NaN}, {"category": NaN, "supplier": NaN, "name": "ç´™ç®±", "spec": "(è¶…ç‰¹å¤§)74.4*42*30.2", "unit": "1å€‹", "unitPrice": 26.5, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "54åŒ…ç±³è›‹æ²ç¶“æ¿ŸåŒ…/56ç›’æ‰‹æç¦®ç›’", "note": NaN}, {"category": "å’–å•¡åŒ…", "supplier": "è¢‹è¢‹ç›¸å‚³", "name": "V330 è€³æ›éæ¿¾åŒ…å¤–è¢‹", "spec": "å¤–å¾‘å¯¬10xé«˜12.5 cm\nå…§å¾‘å¯¬8.6xé«˜12 cm", "unit": "100å…¥/åŒ…\n20åŒ…åœ¨æ‰“9æŠ˜", "unitPrice": 2.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "é­šé¬†å’–å•¡åŒ…", "note": "è¢‹è¢‹ç›¸å‚³ 02-2556-1551å°åŒ—å¸‚å¤ªåŸè·¯11-6è™Ÿ1æ¨“"}, {"category": "ä¹¾ç‡¥åŠ‘", "supplier": "o-buster\nå°åµ©ç„¡æ°§åŒ–å­¸", "name": "å®‰å…¨ç”ŸçŸ³ç°ä¹¾ç‡¥åŠ‘ \nSafe Lime Desiccant(ç¨å®¶ç”¢å“)", "spec": "IC 3g\n45*60mm", "unit": "800pc/è¢‹", "unitPrice": 0.6, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "é¦¬æ—ç³–ç”¨", "note": "å°åµ©ç„¡æ°§åŒ–å­¸å—å€æ¥­å‹™ ç›§æ——ç“0932-649206lineè¯çµ¡"}, {"category": "ç´™å¼µ", "supplier": "é‡‘ç‰å ‚", "name": "é¶´å±‹ä¸‰ç”¨é›»è…¦æ¨™ç±¤", "spec": "åºè™Ÿ111\n2Ã—12-24æ ¼(å¼µ)", "unit": "20å¼µ/åŒ…\n105å¼µ/ç›’\n650å¼µ/ç®±\n1000å¼µ/ç®±", "unitPrice": 4.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "DMå¯„é€ç”¨æ¨™ç±¤", "note": "é‡‘ç‰å ‚è‰è¡™åº—07-812-4089\né«˜é›„å¸‚å‰é®å€ä½›å¾·è¡—38è™Ÿ"}, {"category": NaN, "supplier": NaN, "name": NaN, "spec": "åºè™Ÿ15\n2Ã—3-6æ ¼(å¼µ)", "unit": "20å¼µ/åŒ…\n105å¼µ/ç›’", "unitPrice": 4.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "å…¨å®¶-å¤–ç®±éº¥é ­è²¼ç´™", "note": NaN}, {"category": NaN, "supplier": NaN, "name": NaN, "spec": "åºè™Ÿ16\n2Ã—2-4æ ¼(å¼µ)", "unit": "20å¼µ/åŒ…\n105å¼µ/ç›’", "unitPrice": 4.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "è¶…å•†å–®(è¦çš®.è³£è²¨ä¾¿)", "note": NaN}, {"category": "è²¼ç´™", "supplier": NaN, "name": "é¶´å±‹é€æ˜åœ“å½¢æ¨™ç±¤", "spec": "301T\né€æ˜ 30mmåœ“\næ¯åŒ…120ç²’ï¼Œæ¯å¼µ12ç²’", "unit": "120ç²’/åŒ…", "unitPrice": 0.20833333333333334, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": "ç¦®ç›’\nDMå¯„é€", "note": NaN}, {"category": "7-11\nè¶…å•†å†·å‡ç´™ç®±", "supplier": "7-11", "name": "S60", "spec": "27Ã—20Ã—13cm  10 kg", "unit": "10å€‹/çµ„", "unitPrice": 12.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "S90", "spec": "35Ã—30Ã—25cm  10 kg", "unit": "10å€‹/çµ„", "unitPrice": 20.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": "ä¿éº—é¾", "supplier": "å¤§ç”„(è¯è±)", "name": "ä¿éº—é¾", "spec": "ä¸­(é±ˆé­šç®±)(å¤©åœ°è“‹)", "unit": "çµ„", "unitPrice": 30.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": "å¤§ç”„(è¯è±)", "name": "ä¿éº—é¾", "spec": "ç‰¹å¤§-20KG(å¤©åœ°è“‹)", "unit": "çµ„", "unitPrice": 55.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": "å¤§ç”„(è¯è±)", "name": "ä¿éº—é¾", "spec": "å¤§-16KG(å¤©åœ°è“‹)", "unit": "çµ„", "unitPrice": 48.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": "å¤§ç”„(è¯è±)", "name": "ä¿éº—é¾", "spec": "å°-3å…¬å‡(å¤©åœ°è“‹)", "unit": "çµ„", "unitPrice": 40.0, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": "å…¬ç‰ˆç¦®ç›’", "supplier": "å—æµ·è±", "name": "å…¬ç‰ˆå¤§ç¦®ç›’", "spec": "21Ã—38.5Ã—7cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "çƒé­šå­å…¬ç‰ˆ", "spec": "14Ã—4Ã—24.3cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "è¨­è¨ˆæ¬¾ç›’(é»ƒç™½æ¬¾ã€é­šé¬†ç›’)", "spec": "10.5Ã—6Ã—13cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "çƒé‡‘æ—ºå…­é¡†å…¥", "spec": "20.3Ã—20.6Ã—7.3cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "çƒé‡‘æ—ºå…©é¡†å…¥", "spec": "16.1Ã—10.5Ã—5.6cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "æµ·è‹”ç¦®ç›’", "spec": "34Ã—22.5Ã—95cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "ç±³è›‹æ²ç¶“æ¿Ÿè¢‹", "spec": "13Ã—28Ã—10cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "ç±³è›‹æ²æ‰‹æç¦®ç›’", "spec": "6.8Ã—11.3Ã—18.1", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é³³æ¢¨é…¥6å…¥åº•ç›’2800", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é³³æ¢¨é…¥6å…¥å…§è¥¯ 2000", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é³³æ¢¨é…¥6å…¥è¢–å¥— 825", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é³³æ¢¨é…¥2å…¥åº•ç›’536", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é³³æ¢¨é…¥2å…¥å…§è¥¯ 500", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é³³æ¢¨é…¥2å…¥è¢–å¥—500", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é³³æ¢¨é…¥å°é»‘ç›’ 6675", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "çƒé‡‘æ—ºå¤§ç¦®ç›’è¢–å¥—225", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "çƒçƒQQå…§è¥¯ 2250", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é›™ç½å…§è¥¯1656", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "è›‹æ²135Gæ‰‹æç¦®ç›’2242", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é»ƒè‰²å…¬ç‰ˆéš¨èº«ç›’1260", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é®­é­šé¬†å’–å•¡åŒ… éš¨èº«ç›’1049", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é±ˆé­šé¬†å’–å•¡åŒ… éš¨èº«ç›’1049", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "å…¬ç‰ˆå¤§ç¦®ç›’ åº•ç›’2627", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "å…¬ç‰ˆå¤§ç¦®ç›’ è¢–å¥—427", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "æ‰‹æçƒé­šå­ç²¾ç·»ç¦®ç›’ è¢–å¥—1962", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "é‡ç”Ÿçƒé­šå­ åº•ç›’(ç´…)2000", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "ä¸­ç´™è¢‹922 å°ç´™è¢‹960", "spec": NaN, "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": "æè¢‹", "supplier": NaN, "name": "å°", "spec": "å¯¬17å´8é«˜25cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "ä¸­", "spec": "å¯¬23å´10é«˜28cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}, {"category": NaN, "supplier": NaN, "name": "å¤§", "spec": "å¯¬42å´17é«˜24cm", "unit": NaN, "unitPrice": null, "daily": [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], "usageType": NaN, "note": NaN}];
    const EXCEL_HEADER_ROW = ["å“é …", "å» å•†", "å“å", "å‹è™Ÿ/è¦æ ¼", "åŒ…è£/å–®ä½", "å–®åƒ¹", "11/1", "11/2", "11/3", "11/4", "11/5", "11/6", "11/7", "11/8", "11/9", "11/10", "11/11", "11/12", "11/13", "11/14", "11/15", "11/16", "11/17", "11/18", "11/19", "11/20", "11/21", "11/22", "11/23", "11/24", "11/25", "11/26", "11/27", "11/28", "11/29", "11/30", "é ˜ç”¨é‡‘é¡", "é©ç”¨ç¨®é¡", "å‚™è¨»", "", ""];

    let currentYear = 114;
    let currentMonth = 11;
    let items = [];
    let filteredIndices = [];
    let currentDayFilter = null;
    let rankingVisible = false;
    let unsubscribeRealtime = null;
    let monthClosed = false;

    function adYear(rocYear) {
      return rocYear + 1911;
    }

    function daysInMonth(rocYear, month) {
      const y = adYear(rocYear);
      return new Date(y, month, 0).getDate();
    }

    function getDaysInCurrentMonth() {
      return daysInMonth(currentYear, currentMonth);
    }

    function storageKeyForCurrent() {
      return "nhf_packing_R" + currentYear + "_M" + currentMonth;
    }

    function formatMoney(num) {
      if (num == null || isNaN(num)) return "0";
      return Math.round(num).toLocaleString("zh-TW");
    }

    
    // å£“ç¸®åœ–ç‰‡ï¼šé™åˆ¶å¯¬é«˜èˆ‡å®¹é‡ï¼Œå®Œæˆå¾Œå›å‚³ dataURL èˆ‡ Blob
    function compressImage(file, maxWidth, maxHeight, maxSizeKB, callback) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          let width = img.width;
          let height = img.height;
          const ratio = Math.min(maxWidth / width, maxHeight / height, 1);
          width = width * ratio;
          height = height * ratio;

          const canvas = document.createElement("canvas");
          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0, width, height);

          let quality = 0.9;
          function tryExport() {
            canvas.toBlob(
              function (blob) {
                if (!blob) {
                  alert("åœ–ç‰‡å£“ç¸®å¤±æ•—ï¼Œè«‹æ›ä¸€å¼µç…§ç‰‡ã€‚");
                  return;
                }
                const sizeKB = blob.size / 1024;
                if (sizeKB > maxSizeKB && quality > 0.3) {
                  quality -= 0.1;
                  tryExport();
                } else if (sizeKB > maxSizeKB) {
                  alert("åœ–ç‰‡ä»è¶…éé™åˆ¶å¤§å°ï¼ˆ" + maxSizeKB + "KBï¼‰ï¼Œè«‹æ‹å°ä¸€é»æˆ–å…ˆç¸®åœ–ã€‚");
                } else {
                  const reader2 = new FileReader();
                  reader2.onload = function (ev) {
                    callback(ev.target.result, blob); // dataURL èˆ‡ Blob
                  };
                  reader2.readAsDataURL(blob);
                }
              },
              "image/jpeg",
              quality
            );
          }
          tryExport();
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // é–‹å•Ÿå¤§åœ– Lightbox
    function openLightbox(src) {
      const lb = document.getElementById("lightbox");
      const img = document.getElementById("lightboxImg");
      img.src = src;
      lb.classList.add("active");
    }
    function closeLightbox() {
      const lb = document.getElementById("lightbox");
      lb.classList.remove("active");
    }

    // ç…§ç‰‡ç¸½è¦½ï¼šé–‹å•Ÿã€é—œé–‰èˆ‡æ¸²æŸ“
    function openGallery() {
      const overlay = document.getElementById("galleryOverlay");
      overlay.classList.add("active");
      const search = document.getElementById("gallerySearch");
      if (search) search.value = "";
      renderGallery();
    }

    function closeGallery() {
      const overlay = document.getElementById("galleryOverlay");
      overlay.classList.remove("active");
    }

    function renderGallery() {
      const grid = document.getElementById("galleryGrid");
      if (!grid) return;
      const searchEl = document.getElementById("gallerySearch");
      const kw = (searchEl && searchEl.value ? searchEl.value : "").toLowerCase().trim();
      grid.innerHTML = "";
      const indices = items.map((_, i) => i);
      indices.forEach((idx) => {
        const item = items[idx];
        if (!item || !item.photoUrl) return;
        const fields = [
          item.category || "",
          item.name || "",
          item.supplier || "",
          item.usageType || "",
          item.spec || ""
        ].join(" ").toLowerCase();
        if (kw && !fields.includes(kw)) return;

        const div = document.createElement("div");
        div.className = "gallery-item";

        const img = document.createElement("img");
        img.className = "gallery-thumb";
        img.src = item.photoUrl;
        img.onclick = () => openLightbox(item.photoUrl);
        div.appendChild(img);

        const cap = document.createElement("div");
        cap.className = "gallery-caption";
        cap.textContent = (item.category || "æœªå¡«å“é …") + "ï½œ" + (item.name || "") + (item.supplier ? ("ï½œ" + item.supplier) : "");
        div.appendChild(cap);

        grid.appendChild(div);
      });
    }

    // å–å¾—å–®ä¸€å“é …æœ¬æœˆç¸½é ˜ç”¨æ•¸é‡
    function getItemTotalUsage(item) {
      if (!item) return 0;
      ensureDailyArray(item);
      const DAYS = getDaysInCurrentMonth();
      let sum = 0;
      for (let d = 0; d < DAYS; d++) {
        const v = item.daily[d];
        if (v != null && !isNaN(v)) {
          sum += parseFloat(v);
        }
      }
      return sum;
    }
function ensureDailyArray(item) {
      const DAYS = getDaysInCurrentMonth();
      if (!Array.isArray(item.daily)) {
        item.daily = Array(DAYS).fill(null);
      } else if (item.daily.length < DAYS) {
        item.daily = item.daily.concat(Array(DAYS - item.daily.length).fill(null));
      } else if (item.daily.length > DAYS) {
        item.daily = item.daily.slice(0, DAYS);
      }
    }

    function calcTotal(item) {
      ensureDailyArray(item);
      const price = parseFloat(item.unitPrice || 0) || 0;
      let sumQty = 0;
      const DAYS = getDaysInCurrentMonth();
      for (let i = 0; i < DAYS; i++) {
        const v = parseFloat(item.daily[i]);
        if (!isNaN(v)) sumQty += v;
      }
      return price * sumQty;
    }

    function getFilteredIndicesByKeyword(keyword) {
      if (!keyword) return [];
      const kw = keyword.toLowerCase();
      const res = [];
      items.forEach((item, idx) => {
        const fields = [
          item.category || "",
          item.name || "",
          item.supplier || "",
          item.spec || "",
          item.usageType || ""
        ].join(" ").toLowerCase();
        if (fields.includes(kw)) {
          res.push(idx);
        }
      });
      return res;
    }

    function updateGrandTotal() {
      let grand = 0;
      const indices = filteredIndices.length ? filteredIndices : items.map((_, i) => i);
      indices.forEach(idx => {
        const item = items[idx];
        grand += calcTotal(item);
      });
      document.getElementById("grandTotal").textContent = formatMoney(grand);
    }

    function updateRanking() {
      const tbody = document.getElementById("rankingBody");
      if (!tbody) return;
      tbody.innerHTML = "";
      if (!rankingVisible) return;

      const DAYS = getDaysInCurrentMonth();
      const stats = items.map((item, idx) => {
        ensureDailyArray(item);
        let qty = 0;
        for (let i = 0; i < DAYS; i++) {
          const v = parseFloat(item.daily[i]);
          if (!isNaN(v)) qty += v;
        }
        const amt = calcTotal(item);
        return {
          index: idx,
          category: item.category || "",
          name: item.name || "",
          qty,
          amt
        };
      });

      stats.sort((a, b) => {
        if (b.qty !== a.qty) return b.qty - a.qty;
        return b.amt - a.amt;
      });

      const top = stats.slice(0, 20);
      top.forEach((s, i) => {
        const tr = document.createElement("tr");
        const tdRank = document.createElement("td");
        tdRank.textContent = i + 1;
        const tdCat = document.createElement("td");
        tdCat.textContent = s.category;
        const tdName = document.createElement("td");
        tdName.textContent = s.name;
        const tdQty = document.createElement("td");
        tdQty.textContent = s.qty || "";
        const tdAmt = document.createElement("td");
        tdAmt.textContent = s.amt ? formatMoney(s.amt) : "";
        tr.appendChild(tdRank);
        tr.appendChild(tdCat);
        tr.appendChild(tdName);
        tr.appendChild(tdQty);
        tr.appendChild(tdAmt);
        tbody.appendChild(tr);
      });
    }

    function renderItems() {
      const container = document.getElementById("itemsContainer");
      container.innerHTML = "";
      const indices = filteredIndices.length ? filteredIndices : items.map((_, i) => i);

      document.getElementById("daysInfo").textContent = getDaysInCurrentMonth() + " å¤©";
      const dayInfo = document.getElementById("dayFilterInfo");
      if (currentDayFilter) {
        dayInfo.textContent = "ï½œç›®å‰åªé¡¯ç¤ºæ—¥æœŸï¼š" + currentMonth + "/" + currentDayFilter;
      } else {
        dayInfo.textContent = "";
      }

      indices.forEach((realIdx) => {
        const item = items[realIdx];
        ensureDailyArray(item);

        const card = document.createElement("div");
        card.className = "item-card";

        const header = document.createElement("div");
        header.className = "item-header";

        const idxSpan = document.createElement("span");
        idxSpan.className = "index-badge";
        idxSpan.textContent = realIdx + 1;
        header.appendChild(idxSpan);

        const catInput = document.createElement("input");
        catInput.type = "text";
        catInput.placeholder = "å“é …";
        catInput.value = item.category || "";
        catInput.onchange = (e) => { item.category = e.target.value; };
        header.appendChild(catInput);

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "å“å";
        nameInput.value = item.name || "";
        nameInput.style.flex = "1";
        nameInput.onchange = (e) => { item.name = e.target.value; };
        header.appendChild(nameInput);

        card.appendChild(header);

        nameInput.style.flex = "1";
        nameInput.onchange = (e) => { item.name = e.target.value; };
        header.appendChild(nameInput);

        card.appendChild(header);

        // ç…§ç‰‡å€ï¼šä¸Šå‚³ï¼‹é è¦½ï¼‹ç‹€æ…‹
        const photoLine = document.createElement("div");
        photoLine.className = "line photo-line";

        const photoLabel = document.createElement("label");
        photoLabel.textContent = "ç…§ç‰‡";
        photoLine.appendChild(photoLabel);

        const photoWrapper = document.createElement("div");
        photoWrapper.className = "photo-actions";

        const img = document.createElement("img");
        img.className = "photo-preview";
        if (item.photoUrl) {
          img.src = item.photoUrl;
        } else {
          img.style.display = "none";
        }
        img.onclick = () => {
          if (item.photoUrl) openLightbox(item.photoUrl);
        };
        photoWrapper.appendChild(img);

        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = "image/*";
        fileInput.capture = "environment";

        const statusDiv = document.createElement("div");
        statusDiv.className = "photo-status";
        if (item.photoUrl) {
          statusDiv.textContent = "âœ… å·²æœ‰ç…§ç‰‡";
          statusDiv.classList.add("photo-status-ok");
        } else {
          statusDiv.textContent = "å°šæœªä¸Šå‚³ç…§ç‰‡";
        }

        fileInput.onchange = (e) => {
          const file = e.target.files[0];
          if (!file) return;

          const maxRawSizeMB = 5;
          if (file.size > maxRawSizeMB * 1024 * 1024) {
            alert("åŸå§‹ç…§ç‰‡è¶…é " + maxRawSizeMB + "MBï¼Œè«‹æ‹å°ä¸€é»å†ä¸Šå‚³ã€‚");
            e.target.value = "";
            return;
          }

          statusDiv.textContent = "å£“ç¸®ä¸­â€¦";
          statusDiv.classList.remove("photo-status-ok", "photo-status-warn");
          statusDiv.classList.add("photo-status-wait");

          // å£“ç¸®å¾Œå†ä¸Šå‚³ï¼ˆæˆ–æš«å­˜ï¼‰
          compressImage(file, 800, 800, 200, function (dataUrl, blob) {
            if (typeof uploadPhotoToStorage === "function") {
              statusDiv.textContent = "ä¸Šå‚³é›²ç«¯ä¸­â€¦";
              const path = "consumables_photos/" + currentYear + "_" + currentMonth + "_" + realIdx + ".jpg";
              uploadPhotoToStorage(blob, path)
                .then((url) => {
                  item.photoUrl = url;
                  img.src = url;
                  img.style.display = "block";
                  statusDiv.textContent = "âœ… é›²ç«¯å·²å„²å­˜";
                  statusDiv.classList.remove("photo-status-wait", "photo-status-warn");
                  statusDiv.classList.add("photo-status-ok");
                  renderGallery();
                })
                .catch((err) => {
                  console.error(err);
                  item.photoUrl = dataUrl;
                  img.src = dataUrl;
                  img.style.display = "block";
                  statusDiv.textContent = "âš  åƒ…å„²å­˜åœ¨æœ¬æ©Ÿï¼Œé›²ç«¯ä¸Šå‚³å¤±æ•—";
                  statusDiv.classList.remove("photo-status-wait", "photo-status-ok");
                  statusDiv.classList.add("photo-status-warn");
                  renderGallery();
                  alert("ä¸Šå‚³é›²ç«¯å¤±æ•—ï¼Œæš«æ™‚æ”¹ç‚ºæœ¬æ©Ÿé¡¯ç¤ºã€‚");
                });
            } else {
              item.photoUrl = dataUrl;
              img.src = dataUrl;
              img.style.display = "block";
              statusDiv.textContent = "âš  åƒ…å„²å­˜åœ¨æœ¬æ©Ÿï¼ˆæœªé€£ç·šé›²ç«¯ï¼‰";
              statusDiv.classList.remove("photo-status-wait", "photo-status-ok");
              statusDiv.classList.add("photo-status-warn");
              renderGallery();
            }
          });
        };
        photoWrapper.appendChild(fileInput);

        const clearPhotoBtn = document.createElement("button");
        clearPhotoBtn.type = "button";
        clearPhotoBtn.textContent = "æ¸…é™¤ç…§ç‰‡";
        clearPhotoBtn.className = "danger";
        clearPhotoBtn.onclick = () => {
          if (!item.photoUrl) return;
          if (confirm("è¦åˆªé™¤é€™å€‹è€—æçš„ç…§ç‰‡å—ï¼Ÿï¼ˆä¸æœƒåˆªé™¤é›²ç«¯æª”æ¡ˆï¼Œåªæœƒæ¸…é™¤é€£çµï¼‰")) {
            item.photoUrl = null;
            img.src = "";
            img.style.display = "none";
            statusDiv.textContent = "å°šæœªä¸Šå‚³ç…§ç‰‡";
            statusDiv.classList.remove("photo-status-ok", "photo-status-warn", "photo-status-wait");
            renderGallery();
          }
        };
        photoWrapper.appendChild(clearPhotoBtn);

        photoWrapper.appendChild(statusDiv);

        const photoNote = document.createElement("div");
        photoNote.className = "photo-note";
        photoNote.textContent = "å¯ç”¨æ‰‹æ©Ÿæ‹è€—æå¤–è§€ï¼Œç…§ç‰‡æœƒå£“ç¸®å¾Œä¸Šå‚³ï¼ˆæˆ–åªå­˜åœ¨æœ¬æ©Ÿï¼‰ï¼Œæ¬„ä½åƒ…å­˜é€£çµã€‚";
        photoWrapper.appendChild(photoNote);

        photoLine.appendChild(photoWrapper);
        card.appendChild(photoLine);

        const line1 = document.createElement("div");
        line1.className = "line";

        const supLabel = document.createElement("label");
        supLabel.textContent = "å» å•†";
        line1.appendChild(supLabel);
        const supInput = document.createElement("input");
        supInput.type = "text";
        supInput.value = item.supplier || "";
        supInput.onchange = (e) => { item.supplier = e.target.value; };
        line1.appendChild(supInput);

        const unitLabel = document.createElement("label");
        unitLabel.textContent = "å–®ä½";
        line1.appendChild(unitLabel);
        const unitInput = document.createElement("input");
        unitInput.type = "text";
        unitInput.value = item.unit || "";
        unitInput.onchange = (e) => { item.unit = e.target.value; };
        line1.appendChild(unitInput);

        const priceLabel = document.createElement("label");
        priceLabel.textContent = "å–®åƒ¹";
        line1.appendChild(priceLabel);
        const priceInput = document.createElement("input");
        priceInput.type = "number";
        priceInput.value = item.unitPrice == null ? "" : item.unitPrice;
        priceInput.onchange = (e) => {
          const v = e.target.value.trim();
          item.unitPrice = v === "" ? null : parseFloat(v);
          totalSpan.textContent = formatMoney(calcTotal(item));
          updateGrandTotal();
          updateRanking();
        };
        line1.appendChild(priceInput);

        card.appendChild(line1);

        const line2 = document.createElement("div");
        line2.className = "line";
        const specLabel = document.createElement("label");
        specLabel.textContent = "å‹è™Ÿ/è¦æ ¼";
        line2.appendChild(specLabel);
        card.appendChild(line2);

        const specTa = document.createElement("textarea");
        specTa.value = item.spec || "";
        specTa.placeholder = "å¯å¡«å¯« NY2030 20x30 ç­‰";
        specTa.onchange = (e) => { item.spec = e.target.value; };
        card.appendChild(specTa);

        const line3 = document.createElement("div");
        line3.className = "line";
        const usageLabel = document.createElement("label");
        usageLabel.textContent = "é©ç”¨ç¨®é¡";
        line3.appendChild(usageLabel);
        const usageInput = document.createElement("input");
        usageInput.type = "text";
        usageInput.value = item.usageType || "";
        usageInput.onchange = (e) => { item.usageType = e.target.value; };
        line3.appendChild(usageInput);

        const noteLabel = document.createElement("label");
        noteLabel.textContent = "å‚™è¨»";
        line3.appendChild(noteLabel);
        const noteInput = document.createElement("input");
        noteInput.type = "text";
        noteInput.value = item.note || "";
        noteInput.onchange = (e) => { item.note = e.target.value; };
        line3.appendChild(noteInput);

        card.appendChild(line3);

        // åº«å­˜ï¼šæœŸåˆ / æœŸæœ«ç›¤é»ï¼‹ç†è«–çµå­˜èˆ‡å·®ç•°
        const stockLine = document.createElement("div");
        stockLine.className = "line";
        const stockLabel = document.createElement("label");
        stockLabel.textContent = "åº«å­˜";
        stockLine.appendChild(stockLabel);

        const stockWrapper = document.createElement("div");
        stockWrapper.style.display = "flex";
        stockWrapper.style.flexDirection = "column";
        stockWrapper.style.gap = "4px";

        const stockRow = document.createElement("div");
        stockRow.style.display = "flex";
        stockRow.style.flexWrap = "wrap";
        stockRow.style.gap = "4px";

        const openingInput = document.createElement("input");
        openingInput.type = "number";
        openingInput.placeholder = "æœŸåˆ";
        openingInput.style.maxWidth = "90px";
        openingInput.value = item.openingQty == null ? "" : item.openingQty;
        const closingInput = document.createElement("input");
        closingInput.type = "number";
        closingInput.placeholder = "æœŸæœ«ç›¤é»";
        closingInput.style.maxWidth = "110px";
        closingInput.value = item.closingQty == null ? "" : item.closingQty;

        const stockInfo = document.createElement("div");
        stockInfo.className = "photo-note";

        function refreshStockInfo() {
          const openVal = openingInput.value.trim();
          const closeVal = closingInput.value.trim();
          const opening = openVal === "" ? 0 : (parseFloat(openVal) || 0);
          const used = getItemTotalUsage(item);
          const theoreticalEnd = opening - used;

          if (closeVal === "") {
            stockInfo.textContent = "ç†è«–çµå­˜ï¼ˆæœŸåˆï¼æœ¬æœˆé ˜ç”¨ï¼‰ï¼š" + theoreticalEnd + "ï¼ˆå°šæœªè¼¸å…¥ç›¤é»é‡ï¼‰";
          } else {
            const closing = parseFloat(closeVal) || 0;
            const diff = closing - theoreticalEnd;
            stockInfo.textContent = "ç†è«–çµå­˜ï¼š" + theoreticalEnd + "ï½œç›¤é»ï¼š" + closing + "ï½œå·®ç•°ï¼š" + diff;
          }
        }

        openingInput.onchange = (e) => {
          const v = e.target.value.trim();
          item.openingQty = v === "" ? null : parseFloat(v);
          refreshStockInfo();
        };
        closingInput.onchange = (e) => {
          const v = e.target.value.trim();
          item.closingQty = v === "" ? null : parseFloat(v);
          refreshStockInfo();
        };

        stockRow.appendChild(openingInput);
        stockRow.appendChild(closingInput);
        stockWrapper.appendChild(stockRow);
        stockWrapper.appendChild(stockInfo);

        stockLine.appendChild(stockWrapper);
        card.appendChild(stockLine);

        refreshStockInfo();

        const daysDiv = document.createElement("div");
        daysDiv.className = "days";

        const title = document.createElement("div");
        title.className = "days-title";
        title.textContent = "æ¯æ—¥é ˜ç”¨æ•¸é‡ï¼ˆ" + currentMonth + " æœˆï¼‰";
        daysDiv.appendChild(title);

        const grid = document.createElement("div");
        grid.className = "days-grid";

        const DAYS = getDaysInCurrentMonth();
        for (let d = 0; d < DAYS; d++) {
          const dayNumber = d + 1;
          if (currentDayFilter && dayNumber !== currentDayFilter) continue;

          const cell = document.createElement("div");
          cell.className = "day-cell";

          const lbl = document.createElement("span");
          lbl.textContent = currentMonth + "/" + dayNumber;
          cell.appendChild(lbl);

          const inp = document.createElement("input");
          inp.type = "number";
          inp.placeholder = "0";
          inp.value = item.daily[d] == null ? "" : item.daily[d];
          inp.onchange = (e) => {
            const v = e.target.value.trim();
            item.daily[d] = v === "" ? null : parseFloat(v);
            totalSpan.textContent = formatMoney(calcTotal(item));
            updateGrandTotal();
            updateRanking();
          };
          cell.appendChild(inp);

          grid.appendChild(cell);
        }

        daysDiv.appendChild(grid);
        card.appendChild(daysDiv);

        const footer = document.createElement("div");
        footer.className = "item-footer";

        const totalLabel = document.createElement("div");
        totalLabel.innerHTML = 'å°è¨ˆé‡‘é¡ï¼š<strong><span></span></strong> å…ƒ';
        const totalSpan = totalLabel.querySelector("span");
        totalSpan.textContent = formatMoney(calcTotal(item));
        footer.appendChild(totalLabel);

        const delBtn = document.createElement("button");
        delBtn.className = "danger";
        delBtn.textContent = "åˆªé™¤å“é …";
        delBtn.onclick = () => {
          if (confirm("ç¢ºå®šåˆªé™¤ç¬¬ " + (realIdx + 1) + " å€‹å“é …ï¼Ÿ")) {
            items.splice(realIdx, 1);
            const kw = document.getElementById("searchInput").value.trim();
            filteredIndices = getFilteredIndicesByKeyword(kw);
            renderItems();
            updateGrandTotal();
            updateRanking();
          }
        };
        footer.appendChild(delBtn);

        card.appendChild(footer);

        container.appendChild(card);
      });

      document.getElementById("itemCount").textContent = items.length;
      const infoEl = document.getElementById("searchInfo");
      if (filteredIndices.length) {
        infoEl.textContent = "ç›®å‰é¡¯ç¤º " + indices.length + " / å…¨éƒ¨ " + items.length + " å€‹å“é …ã€‚";
      } else {
        infoEl.textContent = "ç›®å‰é¡¯ç¤ºå…¨éƒ¨ " + items.length + " å€‹å“é …ã€‚";
      }

      updateGrandTotal();
      updateRanking();
    }

    function addItem() {
      const DAYS = getDaysInCurrentMonth();
      const newItem = {
        category: "",
        supplier: "",
        name: "",
        spec: "",
        unit: "",
        unitPrice: null,
        daily: Array(DAYS).fill(null),
        usageType: "",
        note: "",
        openingQty: null,
        closingQty: null,
        photoUrl: null
      };
      items.push(newItem);
      const kw = document.getElementById("searchInput").value.trim();
      filteredIndices = getFilteredIndicesByKeyword(kw);
      renderItems();
    }

    function saveData() {
      try {
        localStorage.setItem(storageKeyForCurrent(), JSON.stringify(items));
      } catch (e) {
        alert("å„²å­˜å¤±æ•—ï¼š" + e.message);
        return;
      }

      // åŒæ­¥åˆ° Firestoreï¼ˆè‹¥å¯ç”¨ï¼‰
      if (typeof db !== "undefined" && db) {
        const docId = "R" + currentYear + "_M" + currentMonth;
        db.collection("consumablesMonths").doc(docId).set({
          rocYear: currentYear,
          month: currentMonth,
          items: items,
          closed: monthClosed,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true }).then(() => {
          alert("å·²å„²å­˜ " + currentYear + "/" + currentMonth + " çš„è³‡æ–™ï¼Œä¸¦åŒæ­¥åˆ°é›²ç«¯ã€‚");
        }).catch((err) => {
          console.error("Firestore åŒæ­¥å¤±æ•—", err);
          alert("å·²å„²å­˜åœ¨æœ¬æ©Ÿï¼Œä½†é›²ç«¯åŒæ­¥å¤±æ•—ï¼š" + err.message);
        });
      } else {
        alert("å·²å„²å­˜ " + currentYear + "/" + currentMonth + " çš„è³‡æ–™ï¼ˆåƒ…ä¿å­˜åœ¨æœ¬æ©Ÿï¼‰ã€‚");
      }
    }

    function clearData() {
      if (!confirm("ç¢ºå®šæ¸…é™¤ " + currentYear + "/" + currentMonth + " çš„æš«å­˜è³‡æ–™ä¸¦æ¢å¾©é è¨­ï¼Ÿ")) return;
      localStorage.removeItem(storageKeyForCurrent());
      loadYearMonth(currentYear, currentMonth, true);
    }

    function onSearchChange() {
      const kw = document.getElementById("searchInput").value.trim();
      filteredIndices = getFilteredIndicesByKeyword(kw);
      renderItems();
    }

    function resetSearch() {
      document.getElementById("searchInput").value = "";
      filteredIndices = [];
      renderItems();
    }

    function showTodayOnly() {
      const today = new Date();
      const adY = adYear(currentYear);
      if (today.getFullYear() !== adY || (today.getMonth() + 1) !== currentMonth) {
        const ok = confirm("ä»Šå¤©ä¸æ˜¯ç›®å‰é¸å®šçš„å¹´æœˆï¼ˆ" + currentYear + "/" + currentMonth + "ï¼‰ã€‚ä»è¦åªé¡¯ç¤ºä»Šå¤©å—ï¼Ÿ");
        if (!ok) return;
      }
      const day = today.getDate();
      const DAYS = getDaysInCurrentMonth();
      if (day > DAYS) {
        alert("ä»Šå¤©æ—¥æœŸè¶…éæœ¬æœˆå¤©æ•¸ï¼Œå°‡ç¶­æŒé¡¯ç¤ºå…¨éƒ¨æ—¥æœŸã€‚");
        currentDayFilter = null;
      } else {
        currentDayFilter = day;
      }
      renderItems();
    }

    function showAllDays() {
      currentDayFilter = null;
      renderItems();
    }

    function toggleRanking() {
      rankingVisible = !rankingVisible;
      const sec = document.getElementById("rankingSection");
      const btn = document.getElementById("rankingToggleBtn");
      if (rankingVisible) {
        sec.style.display = "block";
        btn.textContent = "ğŸ“‰ æ”¶èµ·æ’è¡Œ";
      } else {
        sec.style.display = "none";
        btn.textContent = "ğŸ“Š é¡¯ç¤ºæ’è¡Œ";
      }
      updateRanking();
    }

    function exportCsv() {
      const DAYS = getDaysInCurrentMonth();
      const header = [];
      header.push(EXCEL_HEADER_ROW[0] || "å“é …");
      header.push(EXCEL_HEADER_ROW[1] || "å» å•†");
      header.push(EXCEL_HEADER_ROW[2] || "å“å");
      header.push(EXCEL_HEADER_ROW[3] || "å‹è™Ÿ/è¦æ ¼");
      header.push(EXCEL_HEADER_ROW[4] || "åŒ…è£/å–®ä½");
      header.push(EXCEL_HEADER_ROW[5] || "å–®åƒ¹");
      for (let d = 1; d <= DAYS; d++) {
        header.push(currentMonth + "/" + d);
      }
      header.push(EXCEL_HEADER_ROW[36] || "é‡‘é¡å°è¨ˆ");
      header.push(EXCEL_HEADER_ROW[37] || "é©ç”¨ç¨®é¡");
      header.push(EXCEL_HEADER_ROW[38] || "å‚™è¨»");

      const rows = [header];

      items.forEach((item) => {
        ensureDailyArray(item);
        const row = [
          item.category || "",
          item.supplier || "",
          item.name || "",
          (item.spec || "").replace(/\s+/g, " "),
          item.unit || "",
          item.unitPrice == null ? "" : item.unitPrice
        ];
        for (let d = 0; d < DAYS; d++) {
          row.push(item.daily[d] == null ? "" : item.daily[d]);
        }
        row.push(calcTotal(item));
        row.push(item.usageType || "");
        row.push((item.note || "").replace(/\s+/g, " "));
        rows.push(row);
      });

      const csv = rows.map(cols =>
        cols.map(v => {
          const s = String(v == null ? "" : v);
          if (s.includes(",") || s.includes('"') || s.includes("\n")) {
            return '"' + s.replace(/"/g, '""') + '"';
          }
          return s;
        }).join(",")
      ).join("\n");

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "è€—æé ˜ç”¨_" + currentYear + "_" + currentMonth + ".csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function cloneTemplateForMonth() {
      const DAYS = getDaysInCurrentMonth();
      return TEMPLATE_ITEMS.map(src => {
        return {
          category: src.category,
          supplier: src.supplier,
          name: src.name,
          spec: src.spec,
          unit: src.unit,
          unitPrice: src.unitPrice,
          daily: Array(DAYS).fill(null),
          usageType: src.usageType,
          note: src.note,
          openingQty: src.openingQty || null,
          closingQty: src.closingQty || null,
          photoUrl: src.photoUrl || null
        };
      });
    }

    function loadYearMonth(rocYear, month, forceReset) {
      currentYear = rocYear;
      currentMonth = month;
      document.getElementById("monthInfo").textContent = "ç›®å‰ï¼š" + currentYear + " å¹´ " + currentMonth + " æœˆ";
      currentDayFilter = null;
      filteredIndices = [];
      document.getElementById("searchInput").value = "";

      // æ¸…é™¤ä¸Šä¸€å€‹æœˆçš„å³æ™‚ç›£è½
      if (unsubscribeRealtime) {
        unsubscribeRealtime();
        unsubscribeRealtime = null;
      }
      monthClosed = false;
      updateCloseUI();

      // å…ˆå¾æœ¬æ©Ÿè¼‰å…¥æš«å­˜ï¼ˆè‹¥æœ‰ï¼‰
      let hasLocal = false;
      if (!forceReset) {
        const saved = localStorage.getItem(storageKeyForCurrent());
        if (saved) {
          try {
            items = JSON.parse(saved);
            hasLocal = true;
            renderItems();
          } catch (e) {
            console.warn("è§£æå·²å­˜è³‡æ–™å¤±æ•—ï¼Œæ”¹ç”¨é è¨­ï¼š", e);
          }
        }
      }

      const applyTemplateIfNeeded = () => {
        if (!hasLocal && (!items || !items.length)) {
          if (currentYear === 114 && currentMonth === 11) {
            items = JSON.parse(JSON.stringify(TEMPLATE_ITEMS));
            items.forEach(it => ensureDailyArray(it));
          } else {
            items = cloneTemplateForMonth();
          }
          monthClosed = false;
          renderItems();
          updateCloseUI();
        }
      };

      // è‹¥æœ‰ Firestoreï¼Œå•Ÿç”¨å³æ™‚ç›£è½
      if (typeof db !== "undefined" && db) {
        const docId = "R" + currentYear + "_M" + currentMonth;
        const docRef = db.collection("consumablesMonths").doc(docId);
        unsubscribeRealtime = docRef.onSnapshot((doc) => {
          if (doc.exists) {
            const data = doc.data();
            if (Array.isArray(data.items)) {
              items = data.items;
            }
            monthClosed = !!data.closed;
            renderItems();
            updateGrandTotal();
            updateRanking();
            updateCloseUI();
          } else {
            applyTemplateIfNeeded();
          }
        }, (err) => {
          console.error("Firestore ç›£è½éŒ¯èª¤", err);
          applyTemplateIfNeeded();
        });
      } else {
        applyTemplateIfNeeded();
      }
    }

    
    function updateCloseUI() {
      const app = document.querySelector(".app");
      const btn = document.getElementById("closeBtn");
      const note = document.getElementById("closeNote");
      if (!app || !btn || !note) return;
      if (monthClosed) {
        app.classList.add("closed-mode");
        btn.textContent = "ğŸ”“ è§£é™¤é—œå¸³";
        btn.classList.add("danger");
        note.textContent = "æœ¬æœˆå·²é—œå¸³ï¼šè€—æè³‡æ–™é–å®šä¸å¯ç·¨è¼¯ï¼Œå¦‚éœ€ä¿®æ”¹è«‹å…ˆã€Œè§£é™¤é—œå¸³ã€ã€‚";
      } else {
        app.classList.remove("closed-mode");
        btn.textContent = "ğŸ”’ æœ¬æœˆé—œå¸³";
        btn.classList.remove("danger");
        note.textContent = "æç¤ºï¼šå…ˆè¼¸å…¥æœŸåˆåº«å­˜ï¼Œæœˆåº•å¡«å¯«ç›¤é»é‡ï¼Œç¢ºèªç„¡èª¤å¾Œå¯æŒ‰ã€Œæœ¬æœˆé—œå¸³ã€é–å®šè³‡æ–™ã€‚";
      }
    }

    function toggleCloseMonth() {
      if (!monthClosed) {
        if (!confirm("ç¢ºå®šè¦é—œå¸³ï¼Ÿé—œå¸³å¾Œæœ¬æœˆè€—æè³‡æ–™å°‡é–å®šä¸å¯ç·¨è¼¯ï¼ˆä¹‹å¾Œä»å¯è§£é™¤é—œå¸³ï¼‰ã€‚")) return;
        monthClosed = true;
      } else {
        if (!confirm("ç¢ºå®šè¦è§£é™¤é—œå¸³ï¼Ÿè§£é™¤å¾Œæœ¬æœˆè³‡æ–™å¯å†æ¬¡ä¿®æ”¹ã€‚")) return;
        monthClosed = false;
      }
      updateCloseUI();

      // åƒ…åŒæ­¥é—œå¸³ç‹€æ…‹åˆ° Firestoreï¼ˆè‹¥å¯ç”¨ï¼‰
      if (typeof db !== "undefined" && db) {
        const docId = "R" + currentYear + "_M" + currentMonth;
        db.collection("consumablesMonths").doc(docId).set({
          closed: monthClosed
        }, { merge: true }).catch((err) => {
          console.error("æ›´æ–°é—œå¸³ç‹€æ…‹å¤±æ•—", err);
        });
      }
    }

function onYearMonthChange() {
      const ySel = document.getElementById("yearSelect");
      const mSel = document.getElementById("monthSelect");
      const rocY = parseInt(ySel.value, 10);
      const m = parseInt(mSel.value, 10);
      loadYearMonth(rocY, m, false);
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("yearSelect").value = "114";
      document.getElementById("monthSelect").value = "11";
      loadYearMonth(114, 11, false);

      const gallerySearch = document.getElementById("gallerySearch");
      if (gallerySearch) {
        gallerySearch.addEventListener("input", () => {
          renderGallery();
        });
      }

      updateCloseUI();
    });
  </script>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCFMDVg7T3gXYobW0xQq8yy-XVglOJ_c-o",
    authDomain: "consumables-request-form-30575.firebaseapp.com",
    projectId: "consumables-request-form-30575",
    storageBucket: "consumables-request-form-30575.firebasestorage.app",
    messagingSenderId: "679332317468",
    appId: "1:679332317468:web:2aaaa865ad43bfc8e712d9",
    measurementId: "G-Z1Q2VMK9LX"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const analytics = firebase.analytics();
  const storage = firebase.storage();

  async function uploadPhotoToStorage(blob, path) {
    const storageRef = storage.ref().child(path);
    await storageRef.put(blob);
    return await storageRef.getDownloadURL();
  }
</script>

</body>
</html>
